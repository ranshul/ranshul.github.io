---
title:  "Synchronization and Concurrency: "
date:   2016-09-02 15:37:00
categories: ['OS', 'Threading']
primary: OS
---

Annabeth wants to meet Percy in camp [^1]. But there's a curfew imposed by Diosnyus, the camp director. Odds are, if both of them go out unplanned, they'll be caught. What should they do?

If you want to drop the cool analogy, here's the computer sciency reformulation: There are two processes A and B. A waits for you to save your work and writes it to the hard disk. B shuts down your system. If you don't want to lose your work, what should processes A and B do?

In both cases, one should communicate to the other. Annabeth can go out, make sure things are clear, then call Percy to their spot. 

| Annabeth | Percy |
| - | - |
| Capture the Flag | Capture the Flag |
| Attempt to murder Percy | Eat dinner |
| Eat dinner | Chill with Nico |
| Make sure field's clear | Wait for Annabeth's call |
| Call Percy | Meet Annabeth|

This could be their schedule. The events _make sure field's clear_, _wait for Annabeth's call_, _meet Annabeth_ must happen in this particular order. This is __serialization__ -- enforcing ordering on events.

The events _attempt to murder Percy_ and _capture the flag (Percy)_ are __concurrent__ -- we don't know for sure if it was capture the flag or dinner that ticked Annabeth off. Concurrent does *not* necessarily mean things are happening in parallel at the same time. 

In the second case, process B should shut down the system _after_ process A is done saving things. So, B waits for A to tell it it's done. This is serialization by message passing. B has a mailbox or a pipe which A writes to saying it's done.

In general, concurrent events are non-deterministic. We don't know which event will happen first _before_ the program executes. For example,

| | Thread A | Thread B |
| - | - | - |
| 1. | x = 1 | x = 2|
| 2. | print x| print x|

The final output can be 12 or 22 or 21 depending on which executed last -- if A1 < B1 __and__ A2 < B1, the first printed value will be 1. This relative ordering can not be determined during compile time. Obviously, we can extract something useful out of this. I can tell you for sure that it'll never print 11. As a quick mental exercise, determine the sequence for the other possible outputs.  

[^1]: I acknowledge your sad childhood if you didn't get any of this. 